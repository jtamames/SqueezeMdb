# Installation instructions (Assuming Ubuntu 14.01 or higher).

### You need to be a super-user to do this!

sudo su

### Install Apache + MySql + PHP
apt-get update  
apt-get install lamp-server^ # Set up the MySQL root password, and remember it.

add-apt-repository ppa:ondrej/php  
apt-get update  
apt-get install -y php5.6 php5.6-mcrypt php5.6-mbstring php5.6-curl php5.6-cli php5.6-mysql php5.6-gd php5.6-intl php5.6-xsl php5.6-zip libapache2-mod-php5.6

### Configure PHP
vi /etc/php/5.6/apache2/php.ini  
#Line 372: Set max_execution_time to 30000.  
#Line 660: Set post_max_size to 1200M.  
#LÃ­ne 820: Set upload_max_filesize to 1000M.  

### Restart apache
a2dismod php5  
a2enmod php5.6  
service apache2 restart  

### Create MySQL database.
mysql -u root -p -e "create database squeezem"  

### Clone SqueezeMdb repository.
cd /var/www/html  
git clone https://github.com/jtamames/SqueezeMdb  

### Set up MySQL datababase.
cat /var/www/html/SqueezeMdb/sql/game.sql | mysql -u root -p squeezem  
mysql -u root -p  
CREATE USER 'your_user_name'@'localhost' IDENTIFIED BY 'your_password';  
GRANT ALL PRIVILEGES ON squeezem.* TO 'your_user_name'@'localhost';  

### Configure SqueezeMdb
vi /var/www/html/SqueezeMdb/application/config/config.php 
#Line 26: Set 'base_url' to <your.domain.name>/SqueezeMdb 
#The default is 'localhost/SqueezeMdb'. This will work if accessing from your computer, but not externally.    
#Change it to the full address of your computer to enable external access.    
vi /var/www/html/SqueezeMdb/application/config/database.php  
#Line 79: Set 'username' to 'your_user_name' from the previous step.  
#Line 80: Set 'password', to 'your_password' from the previous step.  

### Grant permissions.
chmod -R 755 /var/www/html/SqueezeMdb  
chown -R www-data:www-data /var/www/html/SqueezeMdb/application/temp/  
chown www-data:www-data /var/www/html/SqueezeMdb/application/cache/  
chmod -R 770 /var/www/html/SqueezeMdb/application/temp/  
chmod 770 /var/www/html/SqueezeMdb/application/cache/

# Creating databases for your SqueezeMeta projects.
1. Once installed the interface should be accesible at http://localhost/SqueezeMdb/index.php/Login
2. Login as the default admin user  
   User: squeezem@squeezem.com  
   Password: squeezem
3. Use the interface to create a non-admin user. Admin users can create new projects and new users. Non-admin users can access the project database and make queries.  
4. In order to create a new project, you will need the following files:
  * Samples file
    * Tab-separated file containing the sample names and any other metadata available. At least one metadata field is required. The example below shows two samples and a mock metadata field named "test" with values 1 and 2. 
    ```
    Sample  test
    SRR1927149 1
    SRR1929489 2
    ```
  * Bins file: This is the *.bintable file generated by SqueezeMeta.
  * Contigs file: This is the *.contigtable file generated by SqueezeMeta.
  * Genes file: This is the *.orftable file generated by SqueezeMeta.
  * Sequences file: This is the *.faa file generated by SqueezeMeta, with minor modifications.
    * The first line must contain the field names "ORF" and "AASEQ" separated by a tab.
    * Each subsequent line must contain the name of each ORF and its aminoacid sequence, separated by a tab.
        * Only the ORF name is needed. E.g. if the fasta header is *"4_2 LOTS OF EXTRA STUFF"* the ORF name would be only *"4_2"*.
5. This new project can be assigned to any non-admin user/s. Once created, the project can be accessed by logging in as the non-admin user.
6. Parsing all the files and creating the MySQL database could take several minutes (around 10 min for the results of the SqueezeMeta test files).
